<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data transformation | airtravel</title>
  <meta name="description" content="Chapter 3 Data transformation | airtravel" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data transformation | airtravel" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data transformation | airtravel" />
  
  
  

<meta name="author" content="shuyue Xu" />


<meta name="date" content="2021-12-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet" />
<script src="libs/highcharts-8.1.2/highcharts.js"></script>
<script src="libs/highcharts-8.1.2/highcharts-3d.js"></script>
<script src="libs/highcharts-8.1.2/highcharts-more.js"></script>
<script src="libs/highcharts-8.1.2/modules/stock.js"></script>
<script src="libs/highcharts-8.1.2/modules/map.js"></script>
<script src="libs/highcharts-8.1.2/modules/annotations.js"></script>
<script src="libs/highcharts-8.1.2/modules/data.js"></script>
<script src="libs/highcharts-8.1.2/modules/drilldown.js"></script>
<script src="libs/highcharts-8.1.2/modules/item-series.js"></script>
<script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script>
<script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script>
<script src="libs/highcharts-8.1.2/modules/exporting.js"></script>
<script src="libs/highcharts-8.1.2/modules/export-data.js"></script>
<script src="libs/highcharts-8.1.2/modules/funnel.js"></script>
<script src="libs/highcharts-8.1.2/modules/heatmap.js"></script>
<script src="libs/highcharts-8.1.2/modules/treemap.js"></script>
<script src="libs/highcharts-8.1.2/modules/sankey.js"></script>
<script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script>
<script src="libs/highcharts-8.1.2/modules/organization.js"></script>
<script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script>
<script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script>
<script src="libs/highcharts-8.1.2/modules/sunburst.js"></script>
<script src="libs/highcharts-8.1.2/modules/vector.js"></script>
<script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script>
<script src="libs/highcharts-8.1.2/modules/xrange.js"></script>
<script src="libs/highcharts-8.1.2/modules/tilemap.js"></script>
<script src="libs/highcharts-8.1.2/modules/venn.js"></script>
<script src="libs/highcharts-8.1.2/modules/gantt.js"></script>
<script src="libs/highcharts-8.1.2/modules/timeline.js"></script>
<script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script>
<script src="libs/highcharts-8.1.2/modules/bullet.js"></script>
<script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script>
<script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script>
<script src="libs/highcharts-8.1.2/modules/lollipop.js"></script>
<script src="libs/highcharts-8.1.2/modules/series-label.js"></script>
<script src="libs/highcharts-8.1.2/plugins/motion.js"></script>
<script src="libs/highcharts-8.1.2/custom/reset.js"></script>
<script src="libs/highcharts-8.1.2/modules/boost.js"></script>
<script src="libs/highchart-binding-0.8.2/highchart.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">covidexp</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#cpi"><i class="fa fa-check"></i><b>2.1</b> CPI</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#bureau-of-transportation-statistics"><i class="fa fa-check"></i><b>2.2</b> Bureau of Transportation Statistics</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#u.s.-field-production-of-crude-oil"><i class="fa fa-check"></i><b>2.3</b> U.S. Field Production of Crude Oil</a></li>
<li class="chapter" data-level="2.4" data-path="data-sources.html"><a href="data-sources.html#united-states-covid-19-cases-and-deaths-by-state-overtime"><i class="fa fa-check"></i><b>2.4</b> United States COVID-19 Cases and Deaths by State overTime</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#cpi-data"><i class="fa fa-check"></i><b>3.1</b> CPI data</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#covid-data"><i class="fa fa-check"></i><b>3.2</b> Covid data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-transformation.html"><a href="data-transformation.html#united-states-covid-19-cases-and-deaths-by-state-overtime-1"><i class="fa fa-check"></i><b>3.2.1</b> United States COVID-19 Cases and Deaths by State overTime</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-transformation.html"><a href="data-transformation.html#travel"><i class="fa fa-check"></i><b>3.2.2</b> Travel</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-transformation.html"><a href="data-transformation.html#oil"><i class="fa fa-check"></i><b>3.2.3</b> Oil</a></li>
<li class="chapter" data-level="3.2.4" data-path="data-transformation.html"><a href="data-transformation.html#covid-19-vaccination-and-case-trends-by-age-group-in-united-states"><i class="fa fa-check"></i><b>3.2.4</b> COVID-19 Vaccination and Case Trends by Age Group in United States</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#cpi-1"><i class="fa fa-check"></i><b>5.1</b> CPI</a></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#covid"><i class="fa fa-check"></i><b>5.2</b> Covid</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="results.html"><a href="results.html#new-cases-and-total-cases-change-by-state-from-2020-jan-to-2021-nov"><i class="fa fa-check"></i><b>5.2.1</b> new cases and total cases change by State from 2020 Jan to 2021 Nov</a></li>
<li class="chapter" data-level="5.2.2" data-path="results.html"><a href="results.html#correlation-cpi-v.s.-covid-19-cases"><i class="fa fa-check"></i><b>5.2.2</b> Correlation CPI V.S. Covid-19 Cases</a></li>
<li class="chapter" data-level="5.2.3" data-path="results.html"><a href="results.html#cluster"><i class="fa fa-check"></i><b>5.2.3</b> cluster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="conclusion.html"><a href="conclusion.html#bar-plot"><i class="fa fa-check"></i><b>7.0.1</b> bar plot</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="results-1.html"><a href="results-1.html"><i class="fa fa-check"></i><b>8</b> Results</a>
<ul>
<li class="chapter" data-level="8.1" data-path="results-1.html"><a href="results-1.html#covid-development-in-u.s."><i class="fa fa-check"></i><b>8.1</b> Covid Development in U.S.</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="results-1.html"><a href="results-1.html#cases-trend-line"><i class="fa fa-check"></i><b>8.1.1</b> Cases Trend Line</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="results-1.html"><a href="results-1.html#covid-development-in-different-states"><i class="fa fa-check"></i><b>8.2</b> Covid Development in Different States</a></li>
<li class="chapter" data-level="8.3" data-path="results-1.html"><a href="results-1.html#clustering-states-by-covid-trend"><i class="fa fa-check"></i><b>8.3</b> Clustering States by Covid Trend</a></li>
<li class="chapter" data-level="8.4" data-path="results-1.html"><a href="results-1.html#consumer-price-index-development"><i class="fa fa-check"></i><b>8.4</b> Consumer Price Index Development</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="results-1.html"><a href="results-1.html#chang-of-living-expenses-by-items"><i class="fa fa-check"></i><b>8.4.1</b> Chang of Living Expenses by Items</a></li>
<li class="chapter" data-level="8.4.2" data-path="results-1.html"><a href="results-1.html#section"><i class="fa fa-check"></i><b>8.4.2</b> </a></li>
<li class="chapter" data-level="8.4.3" data-path="results-1.html"><a href="results-1.html#correlation-between-consumer-items"><i class="fa fa-check"></i><b>8.4.3</b> Correlation Between Consumer Items</a></li>
<li class="chapter" data-level="8.4.4" data-path="results-1.html"><a href="results-1.html#group-cpi-items"><i class="fa fa-check"></i><b>8.4.4</b> Group CPI Items</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="results-1.html"><a href="results-1.html#covids-impact-on-energy-price-index"><i class="fa fa-check"></i><b>8.5</b> Covid’s Impact on Energy Price Index</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="results-1.html"><a href="results-1.html#covid-energy-trend-comparison"><i class="fa fa-check"></i><b>8.5.1</b> Covid &amp; Energy Trend Comparison</a></li>
<li class="chapter" data-level="8.5.2" data-path="results-1.html"><a href="results-1.html#change-of-energy-price-index"><i class="fa fa-check"></i><b>8.5.2</b> Change of Energy Price Index</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">airtravel</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data transformation</h1>
<div id="cpi-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> CPI data</h2>
<p>The cpi data is accessed through cdc website api via <code>googlesheets4::read_sheet</code>.</p>
<pre><code>## # A tibble: 6 × 5
##   year  period periodName value   seriesID   
##   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;      
## 1 2021  M10    October    155.317 SUUR0000SA0
## 2 2021  M09    September  154.076 SUUR0000SA0
## 3 2021  M08    August     153.643 SUUR0000SA0
## 4 2021  M07    July       153.352 SUUR0000SA0
## 5 2021  M06    June       152.649 SUUR0000SA0
## 6 2021  M05    May        151.334 SUUR0000SA0</code></pre>
<p>We firstly add the item names to our main data of interest by matching corresponding seriesID. Since all attributes are in the string format, it’s helpful to convert the item names into the factor type since we are interested in comparing time series for different items and cpi values into numeric values. We also create a new date attribute by concetenating year and month to get the full range of time series, which is further converted into the yearmon type.</p>
<pre><code>## # A tibble: 6 × 7
##   year  period periodName value seriesID    item_name date     
##   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;fct&gt;     &lt;yearmon&gt;
## 1 2021  M10    October     155. SUUR0000SA0 All items Oct 2021 
## 2 2021  M09    September   154. SUUR0000SA0 All items Sep 2021 
## 3 2021  M08    August      154. SUUR0000SA0 All items Aug 2021 
## 4 2021  M07    July        153. SUUR0000SA0 All items Jul 2021 
## 5 2021  M06    June        153. SUUR0000SA0 All items Jun 2021 
## 6 2021  M05    May         151. SUUR0000SA0 All items May 2021</code></pre>
</div>
<div id="covid-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Covid data</h2>
<div id="united-states-covid-19-cases-and-deaths-by-state-overtime-1" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> United States COVID-19 Cases and Deaths by State overTime</h3>
<p>Observe that covid data are daily based and cpi data are monthly based, we use <code>dplyr</code> to shrink covid data to monthly based by summing the number of cases and deaths for every state, where we denote this new dataset <code>cdcmonth.csv</code> after adjusting date into the <code>yearmon</code> format. We also noticed that for the attributes <code>consent_cases</code> and<code>consent_deaths</code> some <code>NA</code>s are denoted as the string <code>'N\A'</code>, where it makes sense to replace them with actual <code>NA</code> since they are indeed missing values. Furthermore, we want to investigate cross state covid cases, where we want to focus on 50 main states. In particular, we have 60 states in total and the reported observations for New York City and Washington D.C. are separated from New York and Maryland respectively, where other states are disjoint from the 50. Hence, we adjust the observations for New York City and Washington D.C. and add them to New York and Maryland in <code>cdcmonth.csv</code> respectively.</p>
<pre><code>## # A tibble: 6 × 15
##   submission_date state tot_cases conf_cases prob_cases new_case pnew_case tot_death conf_death prob_death
##   &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 04/01/2021      CA      3570660    3570660          0     2234         0     58090      58090          0
## 2 05/31/2021      CA      3685032    3685032          0      644         0     62011      62011          0
## 3 02/06/2020      NE            0         NA         NA        0        NA         0         NA         NA
## 4 07/30/2020      ME         3910       3497        413       22         2       123        122          1
## 5 02/02/2021      MS       280182     176228     103954     1059       559      6730       4739       1991
## 6 05/03/2020      NH         2518         NA         NA       89         0        86         NA         NA
## # … with 5 more variables: new_death &lt;dbl&gt;, pnew_death &lt;dbl&gt;, created_at &lt;chr&gt;, consent_cases &lt;chr&gt;,
## #   consent_deaths &lt;chr&gt;</code></pre>
<pre><code>## # A tibble: 6 × 5
##   new_case new_death date    state statefull
##      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    
## 1      227         3 2020-4  AK    Alaska   
## 2     4871         1 2021-4  AK    Alaska   
## 3     2297        19 2020-8  AK    Alaska   
## 4    12078        49 2021-8  AK    Alaska   
## 5    13978        76 2020-12 AK    Alaska   
## 6        0         0 2020-2  AK    Alaska</code></pre>
<pre><code>##   new_case new_death     date state statefull
## 1      227         3 Apr 2020    AK    Alaska
## 2     4871         1 Apr 2021    AK    Alaska
## 3     2297        19 Aug 2020    AK    Alaska
## 4    12078        49 Aug 2021    AK    Alaska
## 5    13978        76 Dec 2020    AK    Alaska
## 6        0         0 Feb 2020    AK    Alaska</code></pre>
</div>
<div id="travel" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Travel</h3>
</div>
<div id="oil" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Oil</h3>
</div>
<div id="covid-19-vaccination-and-case-trends-by-age-group-in-united-states" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> COVID-19 Vaccination and Case Trends by Age Group in United States</h3>
<pre><code>## # A tibble: 6 × 6
##   `Date Administered`    AgeGroupVacc  `7-day_avg_group_ca… Administered_Dose1_… Series_Complete_Po… date      
##   &lt;chr&gt;                  &lt;chr&gt;                        &lt;dbl&gt;                &lt;dbl&gt;               &lt;dbl&gt; &lt;date&gt;    
## 1 11/23/2021 12:00:00 AM &lt;12 Years                     6.80                0.075               0.003 2021-11-23
## 2 11/23/2021 12:00:00 AM 12 - 15 Years                 6.46                0.587               0.488 2021-11-23
## 3 11/23/2021 12:00:00 AM 25 - 39 Years                 7.59                0.716               0.609 2021-11-23
## 4 11/23/2021 12:00:00 AM 40 - 49 Years                 6.88                0.797               0.693 2021-11-23
## 5 11/23/2021 12:00:00 AM 50 - 64 Years                 5.81                0.869               0.764 2021-11-23
## 6 11/22/2021 12:00:00 AM &lt;12 Years                     9.35                0.075               0.003 2021-11-22</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/alfaevc/covidexpense/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/alfaevc/covidexpense/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
